@if (errorMessage()) {
<div
  class="w-full bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4"
  role="alert"
>
  <p class="font-bold">Erro!</p>
  <span class="block sm:inline">{{ errorMessage() }}</span>
</div>
}

<form
  [formGroup]="form"
  (ngSubmit)="onSubmit()"
  class="w-full max-w-lg flex flex-col gap-4 items-center bg-white/95 backdrop-blur-sm border border-green-100 rounded-2xl shadow-lg p-8"
>
  <h1 class="text-3xl font-semibold text-green-700 mb-4">Nova Atividade</h1>

  <div class="w-full flex flex-col gap-1">
    <label class="font-semibold text-gray-700">Título</label>
    <input
      type="text"
      formControlName="name"
      placeholder="Ex: Doação de Roupas"
      class="w-full rounded-lg border border-gray-200 px-4 py-2 focus:ring-2 focus:ring-green-300 outline-none"
    />
    @if (submitted() && form.get('name')?.invalid) {
    <span class="text-red-500 text-sm">Título é obrigatório.</span>
    }
  </div>

  <div class="w-full flex flex-col gap-1">
    <label class="font-semibold text-gray-700">Descrição</label>
    <textarea
      #descInput
      formControlName="description"
      rows="3"
      placeholder="Detalhes da vaga..."
      class="w-full rounded-lg border border-gray-200 px-4 py-2 focus:ring-2 focus:ring-green-300 outline-none"
    ></textarea>
    @if (submitted() && form.get('description')?.invalid) {
    <span class="text-red-500 text-sm">Descrição é obrigatória.</span>
    }
  </div>

  <div class="flex gap-4 w-full items-start">
    <div class="w-1/2 flex flex-col gap-1">
      <label class="font-semibold text-gray-700">Data</label>
      <input
        type="date"
        formControlName="date"
        dateValidator
        class="w-full rounded-lg border border-gray-200 px-4 py-2 focus:ring-2 focus:ring-green-300 outline-none"
      />
      @if (submitted() && form.get('date')?.invalid) {
        @if (form.get('date')?.errors?.['required']) {
      <span class="text-red-500 text-sm">Data é obrigatória.</span>
      }
        @if (form.get('date')?.errors?.['invalidDate']) {
      <span class="text-red-500 text-sm">Deve ser hoje ou posterior.</span>
      }}
    </div>
    <div class="flex flex-col w-1/2 gap-1">
      <label class="font-semibold text-gray-700">Quantidade de vagas</label>
      <input
        type="text"
        formControlName="spots"
        placeholder="23"
        class="rounded-lg border border-gray-200 px-4 py-2 focus:ring-2 focus:ring-green-300 outline-none w-full"
      />
      @if (submitted() && form.get('spots')?.invalid) {
      <span class="text-red-500 text-sm">Deve ser maior que 0.</span>
      }
    </div>
  </div>

  <div class="flex gap-4 w-full">
    <div class="w-full flex flex-col gap-1">
      <label class="font-semibold text-gray-700">CEP</label>
      <input
        type="text"
        formControlName="cep"
        cepValidator
        placeholder="00000000"
        maxlength="8"
        class="w-full rounded-lg border border-gray-200 px-4 py-2 focus:ring-2 focus:ring-green-300 outline-none"
      />
      @if (submitted() && form.get('cep')?.invalid) { @if (form.get('cep')?.errors?.['invalid']) {
      <span class="text-red-500 text-sm">CEP informado não existe.</span>
      } @if (form.get('cep')?.errors?.['required'] || form.get('cep')?.errors?.['minlength']) {
      <span class="text-red-500 text-sm">CEP é obrigatório.</span>
      }}
    </div>
    <div class="flex flex-col w-1/3 gap-1">
      <label class="font-semibold text-gray-700">Número</label>
      <input
        type="text"
        formControlName="number"
        placeholder="123"
        class="rounded-lg border border-gray-200 px-4 py-2 focus:ring-2 focus:ring-green-300 outline-none w-full"
      />
    </div>
  </div>

  <div class="flex gap-4 w-full">
    <div class="w-2/3">
      <label class="font-semibold text-gray-700">Cidade</label>
      <input
        type="text"
        formControlName="city"
        readonly
        class="w-full bg-gray-100 rounded-lg border border-gray-200 px-4 py-2 text-gray-500"
      />
    </div>
    <div class="w-1/3">
      <label class="font-semibold text-gray-700">UF</label>
      <input
        type="text"
        formControlName="state"
        readonly
        class="w-full bg-gray-100 rounded-lg border border-gray-200 px-4 py-2 text-gray-500"
      />
    </div>
  </div>

  <div class="w-full mt-4">
    <button
      type="submit"
      [disabled]="isLoading()"
      class="w-full rounded-lg bg-green-600 px-4 py-3 text-white font-medium hover:bg-green-700 transition cursor-pointer disabled:opacity-50"
    >
      {{ isLoading() ? 'Salvando...' : 'Criar Atividade' }}
    </button>
  </div>

  <div class="text-center mt-2">
    <a routerLink="/busca" class="text-green-600 hover:underline cursor-pointer"
      >Voltar para busca</a
    >
  </div>
</form>
